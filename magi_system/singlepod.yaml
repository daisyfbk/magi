---
apiVersion: v1
kind: Pod
metadata:
  name: magi-system-node
  namespace: limited
  labels:
    app: magi-system
spec:
  containers:
  - image: registry-10-231-0-208.nip.io/mfranzil/magi-system:1
    command:
      - "/app/init_node.sh"
    imagePullPolicy: IfNotPresent
    name: magi-system
    volumeMounts:
    - name: socket
      mountPath: /run/containerd
    - name: systemd
      mountPath: /run/systemd

    securityContext:
      allowPrivilegeEscalation: true
      capabilities:
        add: ["BPF", "NET_ADMIN", "SYS_ADMIN"] # add the capabilities you need https://man7.org/linux/man-pages/man7/capabilities.7.html
      runAsUser: 0
  restartPolicy: Always # we want to be intentional about running this pod
  hostIPC: true # Use the host's ipc namespace https://www.man7.org/linux/man-pages/man7/ipc_namespaces.7.html
  hostNetwork: true # Use the host's network namespace https://www.man7.org/linux/man-pages/man7/network_namespaces.7.html
  hostPID: true # Use the host's pid namespace https://man7.org/linux/man-pages/man7/pid_namespaces.7.html
  volumes:
  - name: socket
    hostPath:
      path: /run/containerd
  - name: systemd
    hostPath:
      path: /run/systemd